"use strict";
Page({
    data: {
        userInfoList: [],
        buttonText: "",
        openid: ""
    },
    onLoad: function () {
        wx.showShareMenu({
            withShareTicket: true,
        });
        wx.cloud.init();
        this.getOpenid();
        this.getAllUserInfo();
    },
    getOpenid: function () {
        var _this = this;
        wx.cloud.callFunction({
            name: "getOpenid"
        }).then(function (res) {
            console.log("openid");
            console.log(res);
            var openid = res.result.openid;
            _this.data.openid = openid;
            _this.isRecord(openid);
        });
    },
    isRecord: function (openid) {
        var _this = this;
        var db = wx.cloud.database();
        var userInfo = db.collection("userInfo");
        userInfo.where({
            _openid: openid
        }).get().then(function (res) {
            console.log("db");
            console.log(res);
            if (res.data.length >= 1) {
                _this.setData({
                    buttonText: "点击按钮消除信息"
                });
            }
            else {
                _this.setData({
                    buttonText: "点击按钮留下记录"
                });
            }
        });
    },
    onGetUserInfo: function (e) {
        var _this = this;
        console.log(e);
        if (this.data.buttonText === "点击按钮留下记录") {
            wx.showModal({
                title: "提示",
                content: "我会获取您的昵称和头像",
                cancelText: "不同意",
                confirmText: "同意",
                success: function (res) {
                    if (res.confirm) {
                        var nickName = e.detail.userInfo.nickName;
                        var avatarUrl = e.detail.userInfo.avatarUrl;
                        _this.addUserInfo(nickName, avatarUrl);
                    }
                }
            });
        }
        else if (this.data.buttonText === "点击按钮消除信息") {
            wx.showModal({
                title: "提示",
                content: "我会删除关于您的信息",
                cancelText: "算了吧",
                confirmText: "还是删掉",
                success: function () {
                    _this.deleteUserInfo();
                }
            });
        }
    },
    addUserInfo: function (nickName, avatarUrl) {
        var _this = this;
        var db = wx.cloud.database();
        var userInfo = db.collection("userInfo");
        userInfo.add({
            data: {
                nickName: nickName,
                avatarUrl: avatarUrl
            }
        }).then(function () {
            _this.setData({
                buttonText: "点击按钮消除信息"
            });
            wx.showToast({
                icon: "none",
                title: "谢谢!"
            });
            _this.getAllUserInfo();
        });
    },
    deleteUserInfo: function () {
        var _this = this;
        wx.cloud.callFunction({
            name: "deleteUserInfo",
            data: {
                key: "_openid",
                value: this.data.openid
            }
        }).then(function () {
            _this.setData({
                buttonText: "点击按钮留下记录"
            });
            _this.getAllUserInfo();
        });
    },
    getAllUserInfo: function () {
        var _this = this;
        var db = wx.cloud.database();
        var userInfo = db.collection("userInfo");
        userInfo.get()
            .then(function (res) {
            _this.setData({
                userInfoList: res.data
            });
        });
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVjb3JkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsicmVjb3JkLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxJQUFJLENBQUM7SUFDRCxJQUFJLEVBQUM7UUFDSCxZQUFZLEVBQUMsRUFBRTtRQUNmLFVBQVUsRUFBQyxFQUFFO1FBQ2IsTUFBTSxFQUFDLEVBQUU7S0FDVjtJQUNELE1BQU07UUFDRixFQUFFLENBQUMsYUFBYSxDQUFDO1lBQ2IsZUFBZSxFQUFFLElBQUk7U0FDdEIsQ0FBQyxDQUFBO1FBQ0osRUFBRSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNoQixJQUFJLENBQUMsU0FBUyxFQUFFLENBQUM7UUFDakIsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO0lBQzFCLENBQUM7SUFDRCxTQUFTO1FBQVQsaUJBVUM7UUFURyxFQUFFLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQztZQUNwQixJQUFJLEVBQUMsV0FBVztTQUNqQixDQUFDLENBQUMsSUFBSSxDQUFDLFVBQUMsR0FBTztZQUNaLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLENBQUE7WUFDckIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNqQixJQUFJLE1BQU0sR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQztZQUMvQixLQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7WUFDMUIsS0FBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUMxQixDQUFDLENBQUMsQ0FBQTtJQUNOLENBQUM7SUFDRCxRQUFRLFlBQUMsTUFBYTtRQUF0QixpQkFrQkM7UUFqQkcsSUFBSSxFQUFFLEdBQUcsRUFBRSxDQUFDLEtBQUssQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUM3QixJQUFJLFFBQVEsR0FBRyxFQUFFLENBQUMsVUFBVSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQ3pDLFFBQVEsQ0FBQyxL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QUFJLENBQUM7WUFDSixLQUFJLENBQUMsT0FBTyxDQUFDO2dCQUNULFVBQVUsRUFBQyxVQUFVO2FBQ3hCLENBQUMsQ0FBQztZQUNILEtBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQztRQUMxQixDQUFDLENBQUMsQ0FBQTtJQUNOLENBQUM7SUFDRCxjQUFjO1FBQWQsaUJBU0M7UUFSQyxJQUFJLEVBQUUsR0FBRyxFQUFFLENBQUMsS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQzdCLElBQUksUUFBUSxHQUFHLEVBQUUsQ0FBQyxVQUFVLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDekMsUUFBUSxDQUFDLEdBQUcsRUFBRTthQUNiLElBQUksQ0FBQyxVQUFDLEdBQU87WUFDWCxLQUFJLENBQUMsT0FBTyxDQUFDO2dCQUNULFlBQVksRUFBQyxHQUFHLENBQUMsSUFBSTthQUN4QixDQUFDLENBQUE7UUFDTCxDQUFDLENBQUMsQ0FBQTtJQUNKLENBQUM7Q0FDSixDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJQYWdlKHtcclxuICAgIGRhdGE6e1xyXG4gICAgICB1c2VySW5mb0xpc3Q6W10sXHJcbiAgICAgIGJ1dHRvblRleHQ6XCJcIixcclxuICAgICAgb3BlbmlkOlwiXCJcclxuICAgIH0sXHJcbiAgICBvbkxvYWQoKXtcclxuICAgICAgICB3eC5zaG93U2hhcmVNZW51KHtcclxuICAgICAgICAgICAgd2l0aFNoYXJlVGlja2V0OiB0cnVlLFxyXG4gICAgICAgICAgfSlcclxuICAgICAgICB3eC5jbG91ZC5pbml0KCk7XHJcbiAgICAgICAgdGhpcy5nZXRPcGVuaWQoKTtcclxuICAgICAgICB0aGlzLmdldEFsbFVzZXJJbmZvKCk7XHJcbiAgICB9LFxyXG4gICAgZ2V0T3BlbmlkKCl7XHJcbiAgICAgICAgd3guY2xvdWQuY2FsbEZ1bmN0aW9uKHtcclxuICAgICAgICAgIG5hbWU6XCJnZXRPcGVuaWRcIlxyXG4gICAgICAgIH0pLnRoZW4oKHJlczphbnkpPT57XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwib3BlbmlkXCIpXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlcyk7XHJcbiAgICAgICAgICAgIGxldCBvcGVuaWQgPSByZXMucmVzdWx0Lm9wZW5pZDtcclxuICAgICAgICAgICAgdGhpcy5kYXRhLm9wZW5pZCA9IG9wZW5pZDtcclxuICAgICAgICAgICAgdGhpcy5pc1JlY29yZChvcGVuaWQpO1xyXG4gICAgICAgIH0pXHJcbiAgICB9LFxyXG4gICAgaXNSZWNvcmQob3BlbmlkOnN0cmluZyl7XHJcbiAgICAgICAgbGV0IGRiID0gd3guY2xvdWQuZGF0YWJhc2UoKTtcclxuICAgICAgICBsZXQgdXNlckluZm8gPSBkYi5jb2xsZWN0aW9uKFwidXNlckluZm9cIik7XHJcbiAgICAgICAgdXNlckluZm8ud2hlcmUoe1xyXG4gICAgICAgICAgX29wZW5pZDpvcGVuaWRcclxuICAgICAgICB9KS5nZXQoKS50aGVuKHJlcz0+e1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcImRiXCIpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhyZXMpO1xyXG4gICAgICAgICAgICBpZihyZXMuZGF0YS5sZW5ndGg+PTEpe1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXREYXRhKHtcclxuICAgICAgICAgICAgICAgICAgICBidXR0b25UZXh0Olwi54K55Ye75oyJ6ZKu5raI6Zmk5L+h5oGvXCJcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXREYXRhKHtcclxuICAgICAgICAgICAgICAgICAgICBidXR0b25UZXh0Olwi54K55Ye75oyJ6ZKu55WZ5LiL6K6w5b2VXCJcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgfSxcclxuICAgIG9uR2V0VXNlckluZm8oZTphbnkpe1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGUpO1xyXG4gICAgICAgIGlmKHRoaXMuZGF0YS5idXR0b25UZXh0ID09PSBcIueCueWHu+aMiemSrueVmeS4i+iusOW9lVwiKXtcclxuICAgICAgICAgICAgd3guc2hvd01vZGFsKHtcclxuICAgICAgICAgICAgICAgIHRpdGxlOlwi5o+Q56S6XCIsXHJcbiAgICAgICAgICAgICAgICBjb250ZW50Olwi5oiR5Lya6I635Y+W5oKo55qE5pi156ew5ZKM5aS05YOPXCIsXHJcbiAgICAgICAgICAgICAgICBjYW5jZWxUZXh0Olwi5LiN5ZCM5oSPXCIsXHJcbiAgICAgICAgICAgICAgICBjb25maXJtVGV4dDpcIuWQjOaEj1wiLFxyXG4gICAgICAgICAgICAgICAgc3VjY2VzczoocmVzKT0+e1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKHJlcy5jb25maXJtKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG5pY2tOYW1lID0gZS5kZXRhaWwudXNlckluZm8ubmlja05hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBhdmF0YXJVcmwgPSBlLmRldGFpbC51c2VySW5mby5hdmF0YXJVcmw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkVXNlckluZm8obmlja05hbWUsYXZhdGFyVXJsKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1lbHNlIGlmKHRoaXMuZGF0YS5idXR0b25UZXh0ID09PSBcIueCueWHu+aMiemSrua2iOmZpOS/oeaBr1wiKXtcclxuICAgICAgICAgICAgd3guc2hvd01vZGFsKHtcclxuICAgICAgICAgICAgICAgIHRpdGxlOlwi5o+Q56S6XCIsXHJcbiAgICAgICAgICAgICAgICBjb250ZW50Olwi5oiR5Lya5Yig6Zmk5YWz5LqO5oKo55qE5L+h5oGvXCIsXHJcbiAgICAgICAgICAgICAgICBjYW5jZWxUZXh0Olwi566X5LqG5ZCnXCIsXHJcbiAgICAgICAgICAgICAgICBjb25maXJtVGV4dDpcIui/mOaYr+WIoOaOiVwiLFxyXG4gICAgICAgICAgICAgICAgc3VjY2VzczooKT0+e1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGVsZXRlVXNlckluZm8oKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgYWRkVXNlckluZm8obmlja05hbWU6c3RyaW5nLGF2YXRhclVybDpzdHJpbmcpe1xyXG4gICAgICAgIGxldCBkYiA9IHd4LmNsb3VkLmRhdGFiYXNlKCk7XHJcbiAgICAgICAgbGV0IHVzZXJJbmZvID0gZGIuY29sbGVjdGlvbihcInVzZXJJbmZvXCIpO1xyXG4gICAgICAgIHVzZXJJbmZvLmFkZCh7XHJcbiAgICAgICAgICAgIGRhdGE6e1xyXG4gICAgICAgICAgICAgICAgbmlja05hbWU6bmlja05hbWUsXHJcbiAgICAgICAgICAgICAgICBhdmF0YXJVcmw6YXZhdGFyVXJsXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KS50aGVuKCgpPT57XHJcbiAgICAgICAgICAgIHRoaXMuc2V0RGF0YSh7XHJcbiAgICAgICAgICAgICAgICBidXR0b25UZXh0Olwi54K55Ye75oyJ6ZKu5raI6Zmk5L+h5oGvXCJcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHd4LnNob3dUb2FzdCh7XHJcbiAgICAgICAgICAgICAgICBpY29uOlwibm9uZVwiLFxyXG4gICAgICAgICAgICAgICAgdGl0bGU6XCLosKLosKIhXCJcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHRoaXMuZ2V0QWxsVXNlckluZm8oKTtcclxuICAgICAgICB9KVxyXG4gICAgfSxcclxuICAgIGRlbGV0ZVVzZXJJbmZvKCl7XHJcbiAgICAgICAgd3guY2xvdWQuY2FsbEZ1bmN0aW9uKHtcclxuICAgICAgICAgICAgbmFtZTpcImRlbGV0ZVVzZXJJbmZvXCIsXHJcbiAgICAgICAgICAgIGRhdGE6e1xyXG4gICAgICAgICAgICAgICAga2V5OlwiX29wZW5pZFwiLFxyXG4gICAgICAgICAgICAgICAgdmFsdWU6dGhpcy5kYXRhLm9wZW5pZFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSkudGhlbigoKT0+e1xyXG4gICAgICAgICAgICB0aGlzLnNldERhdGEoe1xyXG4gICAgICAgICAgICAgICAgYnV0dG9uVGV4dDpcIueCueWHu+aMiemSrueVmeS4i+iusOW9lVwiXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB0aGlzLmdldEFsbFVzZXJJbmZvKCk7XHJcbiAgICAgICAgfSlcclxuICAgIH0sXHJcbiAgICBnZXRBbGxVc2VySW5mbygpe1xyXG4gICAgICBsZXQgZGIgPSB3eC5jbG91ZC5kYXRhYmFzZSgpO1xyXG4gICAgICBsZXQgdXNlckluZm8gPSBkYi5jb2xsZWN0aW9uKFwidXNlckluZm9cIik7XHJcbiAgICAgIHVzZXJJbmZvLmdldCgpXHJcbiAgICAgIC50aGVuKChyZXM6YW55KT0+e1xyXG4gICAgICAgICB0aGlzLnNldERhdGEoe1xyXG4gICAgICAgICAgICAgdXNlckluZm9MaXN0OnJlcy5kYXRhXHJcbiAgICAgICAgIH0pIFxyXG4gICAgICB9KVxyXG4gICAgfVxyXG59KSJdfQ==